<!DOCTYPE html>
<html lang="uk">
<canvas id="mapCanvas" width="4000" height="2829" style="display:none;"></canvas>
<head>
  <meta charset="utf-8" />
  <title>Dronefall: UA Defense | –ì—Ä–∞ –ü–ü–û –£–∫—Ä–∞—ó–Ω–∏</title>
  <meta name="description" content="Dronefall ‚Äî –∑–∞—Ö–æ–ø–ª—é—é—á–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –æ–Ω–ª–∞–π–Ω –≥—Ä–∞ –ø—Ä—è–º–æ —É –±—Ä–∞—É–∑–µ—Ä—ñ. –ë–µ–∑ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ." />
  <meta name="keywords" content="—ñ–≥—Ä–∞, dronefall, –¥—Ä–æ–Ω—Ñ–æ–ª, –æ–Ω–ª–∞–π–Ω, –≤ –±—Ä–∞—É–∑–µ—Ä—ñ, –±–µ–∑ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ. –ì—Ä–∞–π —Ç–∞ –ø–µ—Ä–µ–º–∞–≥–∞–π" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

  <link rel="shortcut icon" href="assets/favicon.png" type="image/png" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css?v=20" />
    <style>

        
#adminPanel {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(0, 0, 0, 0.9);
  color: #fff;
  padding: 15px;
  border-radius: 8px;
  z-index: 1001;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  font-size: 14px;
  width: 250px;
}

#adminPanel h2 {
  margin: 0 0 10px;
  text-align: center;
  color: #0f0;
}

#adminPanel button {
  padding: 6px;
  background: #444;
  color: #fff;
  border: 1px solid #666;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

#adminPanel button:hover {
  background: #666;
}

#adminPanel input[type="number"] {
  width: 50px;
  padding: 4px;
  border-radius: 4px;
  border: 1px solid #666;
  background: #222;
  color: #fff;
}

#adminPanel label {
  margin-right: 8px;
}

#adminPanel .admin-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 8px;
}

@media (max-width: 600px) {
  #adminPanel {
    width: 200px;
    font-size: 12px;
  }
  #adminPanel input[type="number"] {
    width: 40px;
  }
}
body, html {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: sans-serif;
  line-height: 1.4;
  overflow-y: hidden;
}

#map {
  height: 100vh;
  width: 100vw;
}

#controlPanel {
  position: absolute;
  top: 10px;
  right: 10px;
  background: white;
  border: 2px solid #666;
  padding: 10px;
  z-index: 1001;
  border-radius: 6px;
  font-family: sans-serif;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  max-width: 280px;
  box-sizing: border-box;
  overflow-wrap: break-word;
  white-space: normal;
}

#controlPanel .panel-body {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

#controlPanel button {
  font-size: 14px;
  padding: 4px 6px;
  cursor: pointer;
}

#pvoMenu {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  display: flex;
  gap: 8px;
  background: rgba(255, 255, 255, 0.95);
  padding: 8px 12px;
  border-radius: 10px;
  box-shadow: 0 0 6px rgba(0,0,0,0.2);
  width: 90%;
  max-width: 680px;
  overflow-x: auto;
  touch-action: manipulation; 
  -webkit-tap-highlight-color: transparent; 
  background: linear-gradient(to bottom, #222d2f, #1a1f1f);
  border: 2px solid #000;
  box-shadow: inset 0 0 4px #000, 0 0 8px rgba(0, 0, 0, 0.6);
  border-radius: 12px;
  padding: 8px 12px;
  backdrop-filter: blur(4px);
}

.pvo-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px;
  width: 100px;
  cursor: pointer;
  text-align: center;
  font-size: 12px;
  background: #f9f9f9;
  transition: all 0.2s ease;
  user-select: none;
  line-height: 1.2;
}

.pvo-item:hover {
  transform: scale(1.05);
  background: #e0f0ff;
}

.pvo-item img {
  width: 55px;
  height: 36px;
  object-fit: contain;
  margin-bottom: 4px;
}

.pvo-item.selected {
  border-color: #007bff;
  background-color: #d0e7ff;
  box-shadow: 0 0 8px #007bff;
}


#preMenu {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: url('assets/start-screen.webp') center center no-repeat;
  background-size: cover;
  z-index: 1000;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  overflow: hidden;
}

#preMenu .overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 1;
}

.preMenu-content {
  position: relative;
  z-index: 2;
  color: #fff;
  max-width: 90%;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.ai-note {
  font-size: 14px;
  color: #ccc;
  margin-bottom: 10px;
}

.button-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 15px 0;
  width: 100%;
  max-width: 320px;
}

.mode-button {
  padding: 12px 24px;
  font-size: 17px;
  border-radius: 6px;
  background: linear-gradient(to bottom, #2e2e2e, #1b1b1b);
  color: #e0e0e0;
  border: 1px solid #444;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

.mode-button:hover {
  background: linear-gradient(to bottom, #3a3a3a, #222);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
  color: #fff;
  transform: scale(1.02);
}


#legend {
  margin-top: 5px;
  background: rgba(255,255,255,0.05);
  padding: 15px 20px;
  border-radius: 10px;
  font-size: 16px;
  max-width: 400px;
  text-align: left;
  color: #fff;
}

.donate-btn {
  padding: 10px 20px;
  font-size: 18px;
  background-color: #fff;
  color: #000;
  border: 2px solid #28a745;
  border-radius: 8px;
  margin-top: 10px;
  cursor: pointer;
}

.footer-links {
  display: flex;
  gap: 15px;
  align-items: center;
  margin-top: 20px;
}

.footer-links a {
  color: #ccc;
  text-decoration: none;
  font-size: 14px;
}

#loading {
  margin-top: 30px;
  display: none;
}

#loadingText {
  font-size: 16px;
  margin-bottom: 8px;
}

#loadingBar {
  width: 300px;
  height: 20px;
  background: #555;
  margin: 0 auto;
  border-radius: 10px;
  overflow: hidden;
}

#loadingProgress {
  width: 0%;
  height: 100%;
  background: #0f0;
  transition: width 0.3s ease;
}

#alarmIndicator {
  position: absolute;
  bottom: 20px;
  left: 40px;
  display: none;
  z-index: 10000;
  width: 60px;
  text-align: center;
  font-size: 14px;
  font-weight: bold;
  color: #000;
}

.alarm-dot {
  width: 40px;
  height: 40px;
  margin: 0 auto 4px auto;
  background: red;
  border-radius: 50%;
  animation: pulse 0.4s infinite;
  box-shadow: 0 0 15px 6px red;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}


@media (max-width: 600px) {
  .button-group {
    width: 100%;
  }

  #legend {
    font-size: 14px;
  }

  .footer-links {
    flex-direction: column;
    gap: 8px;
  }

  #controlPanel {
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.5);
    color: #fff;
    border: none;
    box-shadow: none;
    padding: 6px 10px;
    font-size: 14px;
    max-width: none;
    z-index: 1002;
  }

  #controlPanel .panel-body {
    flex-direction: row;
    gap: 8px;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
  }

  #controlPanel button {
    display: none !important;
  }

  #alarmIndicator {
    position: fixed !important;
    bottom: 150px !important;
    left: 20px !important;
    transform: none !important;
    z-index: 1003 !important;
  }
}



    </style>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-52ZMNSVTNM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-52ZMNSVTNM');
  </script>
</head>
<body>

  <div id="controlPanel" class="panel" style="display:none;">
    <div class="panel-body">
      <div>üí∞ <span id="money">3500</span></div>
      <div>üåä <span id="waveDisplay">1</span></div>
      <div>üéØ <span id="scoreDisplay">0</span></div>
    </div>
  </div>

  <div id="pvoMenu"></div>

 
  <div id="preMenu">
    <div class="overlay"></div>
    <div class="preMenu-content">
      <div class="ai-note">üß† –¶—è –≥—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –Ω–∞ 95% –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É ChatGPT</div>
      <h1>Dronefall: UA Defense</h1>

      <div class="button-group">
        <button id="startBtn" class="mode-button green">–†–µ–∂–∏–º: –∑ –≤—Å—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω</button>
        <button id="startRightBtn" class="mode-button blue">–†–µ–∂–∏–º: –ø—Ä–æ—Ç–∏ —Ä–æ—Å—ñ—ó ‚û°Ô∏è</button>
        <button id="startHardcoreBtn" class="mode-button red">üî• –•–∞—Ä–¥–∫–æ—Ä-—Ä–µ–∂–∏–º (–±–µ–∑–ª—ñ–º—ñ—Ç —Ä—ñ–≤–Ω—ñ–≤)</button>
      </div>
      <div id="loading">
        <div id="loadingText">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: 0%</div>
        <div id="loadingBar">
          <div id="loadingProgress"></div>
        </div>
      </div>
</div>
      <div id="legend">
        üí∞ <b>–ì—Ä–æ—à—ñ</b> - –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ü–ü–û.<br>
        üåä <b>–•–≤–∏–ª—è</b> - –Ω–æ–º–µ—Ä –∞—Ç–∞–∫–∏.<br>
        üéØ <b>–†–∞—Ö—É–Ω–æ–∫</b> - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–Ω–∏—â–µ–Ω–∏—Ö —Ü—ñ–ª–µ–π.
      </div>

      
      <button onclick="window.open('https://send.monobank.ua/jar/8VKoiC3p6q', '_blank')" class="donate-btn">üíö –î–æ–Ω–∞—Ç –Ω–∞ –ó–°–£</button>

      
      <div style="margin-top: 12px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px; color: #856404; font-weight: 500;">
  üöÄ <b>–£—Å—ñ –Ω–æ–≤–∏–Ω–∏ –ø—Ä–æ –≥—Ä—É ‚Äî –≤ </b><br>
  <a href="https://t.me/Dronefall" target="_blank" style="color: #0056b3; text-decoration: underline;">Telegram</a>
</div>

      
      

    </div>
  </div>

 
  <div id="map"></div>
  <div id="alarmIndicator">
    <div class="alarm-dot"></div>
    ‚ö†Ô∏è –ü–æ–≤—Ç–æ—Ä–Ω—ñ –ø—É—Å–∫–∏
  </div>

  <audio id="alarmSound" src="assets/alarm.mp3"></audio>
  <audio id="bg-music" src="assets/music.mp3" autoplay loop></audio>

  
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="game.js?v=20"></script>
  <script>

document.addEventListener('DOMContentLoaded', () => {
 
  let unlimitedMoney = false;
  let disablePvoRestrictions = false;
  const MAX_PVO_COUNT = 20; 

  
  function ensureAdminPanelVisible() {
    let adminPanel = document.getElementById('adminPanel');
    if (!adminPanel) {
      adminPanel = document.createElement('div');
      adminPanel.id = 'adminPanel';
      document.body.appendChild(adminPanel);
    }
    adminPanel.innerHTML = `
      <h2>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <div class="admin-section">
        <label><input type="checkbox" id="unlimitedMoney"> –ù–µ–æ–±–º–µ–∂–µ–Ω—ñ –≥—Ä–æ—à—ñ</label>
        <button onclick="addMoney(10000)">–î–æ–¥–∞—Ç–∏ 10000 üí∞</button>
      </div>
      <div class="admin-section">

      </div>
      <div class="admin-section">
        <label><input type="checkbox" id="disablePvoRestrictions"> –í–∏–º–∫–Ω—É—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è –ü–ü–û</label>
        
      </div>
    `;
    adminPanel.style.display = 'flex';
    adminPanel.style.opacity = '1';
    adminPanel.style.visibility = 'visible';
    adminPanel.style.zIndex = '1001';
    adminPanel.style.position = 'fixed';
    adminPanel.style.top = '10px';
    adminPanel.style.left = '10px';
    adminPanel.style.background = 'rgba(0, 0, 0, 0.9)';
    adminPanel.style.color = '#fff';
    adminPanel.style.padding = '15px';
    adminPanel.style.borderRadius = '8px';
    adminPanel.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.5)';
    adminPanel.style.width = '250px';
    adminPanel.style.fontSize = '14px';
    initializeAdminPanelEvents();
  }

 
  function initializeAdminPanelEvents() {
    const unlimitedMoneyCheckbox = document.getElementById('unlimitedMoney');
    const disablePvoRestrictionsCheckbox = document.getElementById('disablePvoRestrictions');

    if (!unlimitedMoneyCheckbox || !disablePvoRestrictionsCheckbox) {
      console.error('–ß–µ–∫–±–æ–∫—Å–∏ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
      return;
    }

    unlimitedMoneyCheckbox.addEventListener('change', function () {
      unlimitedMoney = this.checked;
      money = unlimitedMoney ? Infinity : 3500;
      updateMoney();
      console.log('–ù–µ–æ–±–º–µ–∂–µ–Ω—ñ –≥—Ä–æ—à—ñ:', unlimitedMoney);
    });

    disablePvoRestrictionsCheckbox.addEventListener('change', function () {
      disablePvoRestrictions = this.checked;
      updatePvoPurchaseAvailability();
      console.log('–û–±–º–µ–∂–µ–Ω–Ω—è –ü–ü–û –≤–∏–º–∫–Ω–µ–Ω–æ:', disablePvoRestrictions);
    });
  }


  window.addMoney = function (amount) {
    if (typeof money === 'undefined') {
      console.error('–ó–º—ñ–Ω–Ω–∞ money –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–∞');
      return;
    }
    money += amount;
    updateMoney();
    console.log('–î–æ–¥–∞–Ω–æ –≥—Ä–æ—à–µ–π:', amount, '–ù–æ–≤–∏–π –±–∞–ª–∞–Ω—Å:', money);
  };


  window.spawnEnemies = function () {
    if (!defensePoints || !map || !drones || !rockets) {
      console.error('–ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∑–º—ñ–Ω–Ω—ñ: defensePoints, map, drones, rockets');
      return;
    }

    const spawnType = document.getElementById('spawnType')?.value;
    const spawnCount = parseInt(document.getElementById('spawnCount')?.value) || 1;
    const aliveTargets = defensePoints.filter(p => p.alive);

    if (aliveTargets.length === 0) {
      alert('–ù–µ–º–∞—î –∂–∏–≤–∏—Ö —Ü—ñ–ª–µ–π –¥–ª—è –∞—Ç–∞–∫–∏!');
      console.warn('–°–ø–∞–≤–Ω –Ω–µ–º–æ–∂–ª–∏–≤–∏–π: –Ω–µ–º–∞—î –∂–∏–≤–∏—Ö —Ü—ñ–ª–µ–π');
      return;
    }

    console.log('–°–ø–∞–≤–Ω –≤–æ—Ä–æ–≥—ñ–≤:', spawnType, '–ö—ñ–ª—å–∫—ñ—Å—Ç—å:', spawnCount);

    for (let i = 0; i < spawnCount; i++) {
      const target = aliveTargets[Math.floor(Math.random() * aliveTargets.length)];
      let startLat, startLng;

      if (rightOnlyMode) {
        [startLat, startLng] = spawnRight();
        console.log('–°–ø–∞–≤–Ω –∑ –ø—Ä–∞–≤–æ–≥–æ –±–æ–∫—É:', startLat, startLng);
      } else {
        const direction = ["left", "right", "top", "bottom"][Math.floor(Math.random() * 4)];
        if (direction === "left") {
          startLat = Math.random() * 2829;
          startLng = -200;
        } else if (direction === "right") {
          startLat = Math.random() * 2829;
          startLng = 4000 + 200;
        } else if (direction === "top") {
          startLat = -200;
          startLng = Math.random() * 4000;
        } else {
          startLat = 2829 + 200;
          startLng = Math.random() * 4000;
        }
        console.log('–°–ø–∞–≤–Ω –∑ –Ω–∞–ø—Ä—è–º–∫—É:', direction, '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:', startLat, startLng);
      }

      let enemy;
      if (spawnType === 'drone') {
        enemy = {
          type: 'light',
          position: [startLat, startLng],
          marker: L.marker([startLat, startLng], {
            icon: L.divIcon({
              className: 'rotating-icon',
              html: `<img src="assets/drone.png" width="40" height="40" />`,
              iconSize: [40, 40],
              iconAnchor: [20, 20]
            })
          }).addTo(map),
          target: [target.lat, target.lng],
          speed: 0.21 + Math.random() * 0.31 + (waveNumber || 1) * 0.01,
          hp: 13 + (waveNumber || 1) * 10
        };
        drones.push(enemy);
        console.log('–°—Ç–≤–æ—Ä–µ–Ω–æ –¥—Ä–æ–Ω:', enemy);
      } else if (spawnType === 'heavyDrone') {
        enemy = {
          type: 'heavy',
          position: [startLat, startLng],
          marker: L.marker([startLat, startLng], {
            icon: L.divIcon({
              className: 'rotating-icon',
              html: `<img src="assets/heavy-drone.png" width="40" height="40" />`,
              iconSize: [40, 40],
              iconAnchor: [20, 20]
            })
          }).addTo(map),
          target: [target.lat, target.lng],
          speed: 0.15 + Math.random() * 0.21 + (waveNumber || 1) * 0.01,
          hp: 220 + (waveNumber || 1) * 27
        };
        drones.push(enemy);
        console.log('–°—Ç–≤–æ—Ä–µ–Ω–æ –≤–∞–∂–∫–∏–π –¥—Ä–æ–Ω:', enemy);
      } else if (spawnType === 'rocket') {
        enemy = {
          type: 'rocket',
          position: [startLat, startLng],
          marker: L.marker([startLat, startLng], {
            icon: L.divIcon({
              className: 'rotating-icon',
              html: `<img src="assets/rocket1.png" width="40" height="40" />`,
              iconSize: [40, 40],
              iconAnchor: [20, 20]
            })
          }).addTo(map),
          target: [target.lat, target.lng],
          speed: 1.2 + Math.random() * 1.6 + (waveNumber || 1) * 0.01,
          hp: 20 + (waveNumber || 1) * 15
        };
        rockets.push(enemy);
        console.log('–°—Ç–≤–æ—Ä–µ–Ω–æ —Ä–∞–∫–µ—Ç—É:', enemy);
      } else if (spawnType === 'nuke') {
        enemy = {
          type: 'nuke',
          hp: 5000,
          speed: 1,
          position: [startLat, startLng],
          target: [target.lat, target.lng],
          marker: L.marker([startLat, startLng], {
            icon: L.icon({
              iconUrl: 'assets/nuke.png',
              iconSize: [60, 60],
              iconAnchor: [30, 30]
            })
          }).addTo(map)
        };
        rockets.push(enemy);
        console.log('–°—Ç–≤–æ—Ä–µ–Ω–æ —è–¥–µ—Ä–Ω—É —Ä–∞–∫–µ—Ç—É:', enemy);
      }
    }
  };

 
  window.clearEnemies = function () {
    if (!drones || !rockets || !map) {
      console.error('–ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ –∑–º—ñ–Ω–Ω—ñ: drones, rockets, map');
      return;
    }
    drones.forEach(drone => map.removeLayer(drone.marker));
    rockets.forEach(rocket => map.removeLayer(rocket.marker));
    drones = [];
    rockets = [];
    console.log('–í—Å—ñ –≤–æ—Ä–æ–≥–∏ –æ—á–∏—â–µ–Ω–æ');
  };

  
  function updatePvoPurchaseAvailability() {
    if (!pvoList || !pvoTypes) {
      console.error('–ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ –∑–º—ñ–Ω–Ω—ñ: pvoList, pvoTypes');
      return;
    }

    const effectiveMaxPvoCount = disablePvoRestrictions ? 10000000 : MAX_PVO_COUNT;
    console.log('–û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –ü–ü–û, –ª—ñ–º—ñ—Ç:', effectiveMaxPvoCount, '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ü–ü–û:', pvoList.length);

    document.querySelectorAll('.pvo-item').forEach(div => {
      if (pvoList.length >= effectiveMaxPvoCount) {
        div.classList.add('disabled');
        div.onclick = () => {
          alert(`‚ùå –î–æ—Å—è–≥–Ω—É—Ç–æ –ª—ñ–º—ñ—Ç ${MAX_PVO_COUNT} –ü–ü–û. –ü–æ–∫—Ä–∞—â–∏ –≤–∂–µ —Å—Ç–≤–æ—Ä–µ–Ω—ñ.`);
          console.warn('–õ—ñ–º—ñ—Ç –ü–ü–û –¥–æ—Å—è–≥–Ω—É—Ç–æ:', pvoList.length);
        };
      } else {
        div.classList.remove('disabled');
        const typeName = div.querySelector("b")?.textContent;
        const type = pvoTypes.find(t => t.name === typeName);
        if (!type) {
          console.error('–¢–∏–ø –ü–ü–û –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ:', typeName);
          return;
        }

        div.onclick = () => {
          const count = pvoPurchaseCounts[type.name] || 0;
          const dynamicPrice = Math.floor(type.price * Math.pow(1.2, count));

          if (money < dynamicPrice) {
            alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤. –ü–æ—Ç—Ä—ñ–±–Ω–æ ${dynamicPrice} –∫–∞—Ä–±–æ–≤–∞–Ω—Ü—ñ–≤.`);
            console.warn('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏:', type.name, '–¶—ñ–Ω–∞:', dynamicPrice);
            return;
          }

          selectedPVO = type;
          buyingMode = true;
          document.querySelectorAll('.pvo-item').forEach(item => item.classList.remove('selected'));
          div.classList.add('selected');
          sellPVOButton.disabled = true;
          console.log('–û–±—Ä–∞–Ω–æ –ü–ü–û –¥–ª—è –ø–æ–∫—É–ø–∫–∏:', type.name);
        };
      }
    });
  }

  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      const adminPanel = document.getElementById('adminPanel');
      if (mutation.type === 'attributes' && mutation.target === adminPanel) {
        ensureAdminPanelVisible();
      } else if (mutation.type === 'childList' && !adminPanel) {
        ensureAdminPanelVisible();
      }
    });
  });

  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true,
    attributeFilter: ['style', 'class']
  });


  setInterval(() => {
    const adminPanel = document.getElementById('adminPanel');
    if (!adminPanel || adminPanel.style.display === 'none' || adminPanel.style.opacity === '0' || adminPanel.style.visibility === 'hidden') {
      ensureAdminPanelVisible();
    }
  }, 100);


  ensureAdminPanelVisible();

  const originalLaunchGame = window.launchGame;
  window.launchGame = function () {
    originalLaunchGame();
    setTimeout(ensureAdminPanelVisible, 0);
    console.log('–ì—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞, –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');
  };
});

// üéÆ –û—Å–Ω–æ–≤–Ω—ñ —ñ–≥—Ä–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ
let money = 3500;
let rightOnlyMode = false;
let selectedPVO = null;
let buyingMode = false;
let gameOver = false;
let score = 0;
let movingPVO = null; 
let moveMode = false; 
let hardcoreMode = false;
let nukeLaunched = false;
let gameWon = false;
const PIXEL_TO_METERS = 1;
let currentWave = 0;
let isWaveInProgress = false;
let gameStartTime = 0;
// üß© –û—Ç—Ä–∏–º–∞–Ω–Ω—è DOM-–µ–ª–µ–º–µ–Ω—Ç—ñ–≤
const preMenu = document.getElementById("preMenu");
const startBtn = document.getElementById("startBtn");
const loading = document.getElementById("loading");
const loadingText = document.getElementById("loadingText");
const loadingProgress = document.getElementById("loadingProgress");

// üì¶ –ú–∞—Å–∏–≤ —Ä–µ—Å—É—Ä—Å—ñ–≤ –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
const assetsToLoad = [
  "assets/map.png",
  "assets/drone.png",
  "assets/rocket1.png",
  "assets/heavy-drone.png",
  "assets/pvo1.png",
  "assets/pvo3.png",
  "assets/pvo5.png",
  "assets/reb.png",
  "assets/f16.png",
  "assets/nuke.png"
];
// üì• –§—É–Ω–∫—Ü—ñ—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
function preloadImages(assetList, onProgress, onComplete) {
  let loaded = 0;

  assetList.forEach(src => {
    const img = new Image();
    img.onload = () => {
      loaded++;
      onProgress(Math.floor((loaded / assetList.length) * 100));
      if (loaded === assetList.length) {
        onComplete();
      }
    };
    img.onerror = () => {
      console.warn(`–¢–∞ —à–æ—Å—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–æ—Å—å üò¨ ${src}`);
      loaded++;
      onProgress(Math.floor((loaded / assetList.length) * 100));
      if (loaded === assetList.length) {
        onComplete();
      }
    };
    img.src = src;
  });
}
// ‚ñ∂Ô∏è –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∑–∞–ø—É—Å–∫—É –≥—Ä–∏
startBtn.onclick = () => {
  rightOnlyMode = false;
  launchGame();
};

document.getElementById("startRightBtn").onclick = () => {
  rightOnlyMode = true;
  launchGame();
};
document.getElementById("startHardcoreBtn").onclick = () => {
  rightOnlyMode = false;
  hardcoreMode = true;
  launchGame();
};

// üöÄ –ó–∞–ø—É—Å–∫ –≥—Ä–∏ (–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤, –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –º–µ–Ω—é)
function launchGame() {
  startBtn.disabled = true;
  document.getElementById("startRightBtn").disabled = true;
  loading.style.display = "block";

  preloadImages(assetsToLoad, (percent) => {
    loadingText.textContent = `–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${percent}%`;
    loadingProgress.style.width = percent + "%";
  }, () => {
    preMenu.style.display = "none";
    initializeMapAndGame();
  });
}



// üó∫Ô∏è –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ (Leaflet), –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ–Ω—É-–∫–∞—Ä—Ç–∏
function initializeMapAndGame() {
  gameStartTime = performance.now();

  
  map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -2,
    maxZoom: 4
  });

  const imageBounds = [[0, 0], [2829, 4000]];
  L.imageOverlay("assets/map.png", imageBounds).addTo(map);
  map.fitBounds(imageBounds);

  const mapImage = new Image();
  mapImage.src = "assets/map.png";
  mapPixelCanvas = document.createElement('canvas');
  mapPixelCanvas.width = mapImage.width;
  mapPixelCanvas.height = mapImage.height;
  const ctx = mapPixelCanvas.getContext('2d');
  mapImage.onload = () => {
    ctx.drawImage(mapImage, 0, 0);
  };

  const paddingTop = 1000;
  const paddingLeft = 1500;
  const paddingBottom = 1000;
  const paddingRight = 1500;

  const paddedBounds = [
    [-paddingTop, -paddingLeft],
    [2829 + paddingBottom, 4000 + paddingRight]
  ];
  map.setMaxBounds(paddedBounds);



// üéØ –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —Ü—ñ–ª–µ–π —ñ–∑ –º–∞—Å–∏–≤—É
function getRandomTargets(arr, count) {
  const shuffled = arr.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}
document.getElementById("controlPanel").style.display = "block";
// üìç –ü–æ—á–∞—Ç–∫–æ–≤—ñ —Ü—ñ–ª—ñ –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É
const allDefensePoints = getRandomTargets(allowedSpawnPoints, 5); 

const defensePoints = []; 
// üéØ –†–æ–∑–º—ñ—â–µ–Ω–Ω—è –º—ñ—à–µ–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç—ñ –∑ –º–∞—Ä–∫–µ—Ä–æ–º —ñ –∑–æ–Ω–æ—é, –∫—É–¥–∏ –Ω–µ –º–æ–∂–Ω–∞ —Å—Ç–∞–≤–∏—Ç–∏ –ü–ü–û
function activateDefensePoint(index) {
  const coords = allDefensePoints[index];
  const [lat, lng] = coords;

 const myIcon = L.icon({
  iconUrl: 'assets/tet.png', 
  iconSize: [45, 45],
  iconAnchor: [20, 20],
  popupAnchor: [0, -20]
});

  const marker = L.marker([lat, lng], { icon: myIcon }).addTo(map).bindPopup("üéØ –¶—ñ–ª—å");



  const noBuildCircle = L.circle([lat, lng], {
    radius: 100,
    color: "red",
    fillColor: "#ff4444",
    fillOpacity: 0.2,
    dashArray: "4, 4",
    interactive: false
  }).addTo(map);

  defensePoints.push({
    lat,
    lng,
    marker,
    noBuildCircle, 
    alive: true
  });
}



// üõ°Ô∏è –û–ø–∏—Å —É—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –ü–ü–û: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —Ü—ñ–Ω–∏, –∫–∞—Ä—Ç–∏–Ω–∫–∏
const pvoTypes = [
  { name: "–ö—É–ª–µ–º–µ—Ç", price: 500, radius: 100, damage: 15, cd: 550, img: "assets/pvo1.png" }, 
  { name: "–°-300", price: 1000, radius: 140, damage: 27, cd: 850, img: "assets/pvo3.png" },
  { name: "Patriot", price: 2500, radius: 210, damage: 50, cd: 1000, img: "assets/pvo5.png" },
  { name: "F-16", price: 7000, radius: 270, damage: 300, cd: 700, img: "assets/f16.png", mobile: true, noUpgrade: true },
  { name: "–†–ï–ë", price: 800, radius: 100, damage: 0, cd: 0, reb: true, slowFactor: 0.4, img: "assets/reb.png" }
  
// üé® –ö–æ–ª—å–æ—Ä–∏ –∑–æ–Ω –¥—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É –ü–ü–û
];
const pvoColorMap = {
  "–ö—É–ª–µ–º–µ—Ç": "#52f752",
  "–°-300": "#30c730",
  "Patriot": "#228B22",
  "–†–ï–ë": "#d673fa",
  "F-16": "#1f8cff"
};


const colorMap = {
  50: "#b2ffb2",
  100: "#88ff88",
  150: "#55cc55",
  200: "#33aa33",
  250: "#229922"
  
};
// üìã –ë–æ–∫–æ–≤–µ –º–µ–Ω—é –∑ –≤–∏–±–æ—Ä–æ–º –ü–ü–û
const menu = document.getElementById("pvoMenu");

const pvoPurchaseCounts = {};

// ‚úàÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è F-16 (—è–∫—â–æ –æ–±—Ä–∞–Ω–æ)
const movePVOButton = document.createElement("button");
movePVOButton.textContent = "‚úàÔ∏è –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ F-16";
movePVOButton.disabled = true; 
movePVOButton.style.marginTop = "10px";
menu.appendChild(movePVOButton);
const sellPVOButton = document.createElement("button");
sellPVOButton.id = "sellPVOButton";
sellPVOButton.textContent = "–ü—Ä–æ–¥–∞—Ç–∏ –ü–ü–û";
sellPVOButton.disabled = true;
sellPVOButton.style.marginTop = "10px";
menu.appendChild(sellPVOButton);
// ‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ü–ü–û (–¥–æ 10 —Ä–∞–∑—ñ–≤, F-16 –Ω–µ –º–æ–∂–Ω–∞)
const upgradePVOButton = document.createElement("button");
upgradePVOButton.id = "upgradePVOButton";
upgradePVOButton.textContent = "–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –ü–ü–û (üí∞100)";
upgradePVOButton.disabled = true;
upgradePVOButton.style.marginTop = "10px";
menu.appendChild(upgradePVOButton);



const upgradeInfo = document.createElement("div");
upgradeInfo.id = "upgradeInfo";
upgradeInfo.style.marginTop = "10px";
upgradeInfo.style.color = "white";
menu.appendChild(upgradeInfo);
movePVOButton.onclick = () => {
  if (!selectedPVO || selectedPVO.name !== "F-16") return;
  movingPVO = selectedPVO;
  moveMode = true;
  alert("‚úàÔ∏è –ö–ª—ñ–∫–Ω–∏ –Ω–∞ –∫–∞—Ä—Ç—É, —â–æ–± –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ F-16");
};

upgradePVOButton.onclick = () => {
  if (!selectedPVO) return;
  if (selectedPVO.noUpgrade) {
    alert("‚ùå F-16 –Ω–µ –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â—É–≤–∞—Ç–∏!");
    return;
  }
  if (selectedPVO.upgradeCount >= 10) {
  alert("‚ùå –¶–µ –ü–ü–û –ø–æ–∫—Ä–∞—â–µ–Ω–æ –≤–∂–µ 10 —Ä–∞–∑—ñ–≤ - –±—ñ–ª—å—à–µ –Ω–µ –º–æ–∂–Ω–∞!");
  return;
}


  const baseUpgradeCost = 100; 
const upgradeCost = baseUpgradeCost * Math.pow(2, selectedPVO.upgradeCount);
if (money < upgradeCost) {
  alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è, –ø–æ—Ç—Ä—ñ–±–Ω–æ: ${upgradeCost} –∫–∞—Ä–±–æ–≤–∞–Ω—Ü—ñ–≤.`);
  return;
}
money -= upgradeCost;



  selectedPVO.damage = Math.min(selectedPVO.damage + 2, selectedPVO.damage * 3);
  selectedPVO.radius = Math.min(selectedPVO.radius + 7, selectedPVO.radius * 3);
  selectedPVO.cd = Math.max(selectedPVO.cd - 100, 100);

  selectedPVO.upgradeCount++; 
  upgradeInfo.textContent = `–ü–æ–∫—Ä–∞—â–µ–Ω–æ: ${selectedPVO.upgradeCount} / 10`;
  updateUpgradeButtonText();
  
  if (selectedPVO.rangeCircle) {
    selectedPVO.rangeCircle.setRadius(selectedPVO.radius);
    const zoneColor = pvoColorMap[selectedPVO.name] || "#00FF00";
selectedPVO.rangeCircle.setStyle({
  color: zoneColor,
  fillColor: zoneColor,

      fillOpacity: 0.2,
  className: 'no-blur-circle'
    });
  }
  
  updateMoney();
};


pvoTypes.forEach((type) => {
  const div = document.createElement("div");
  div.className = "pvo-item";

 
  div.innerHTML = `
    <img src="${type.img}" />
    <b>${type.name}</b><br/>
    üí∞${type.price}<br/>
    üìè${type.radius}
  `;

  div.onclick = () => {
    const count = pvoPurchaseCounts[type.name] || 0;
    const dynamicPrice = Math.floor(type.price * Math.pow(1.2, count));

    if (money < dynamicPrice) {
      alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤, –ø–æ—Ç—Ä—ñ–±–Ω–æ: ${dynamicPrice} –∫–∞—Ä–±–æ–≤–∞–Ω—Ü—ñ–≤.`);
      return;
    }
    
  selectedPVO = null;
  sellPVOButton.disabled = true;
  upgradePVOButton.disabled = true;
  upgradeInfo.textContent = "";
    selectedPVO = type;
    buyingMode = true;

    document.querySelectorAll('.pvo-item').forEach(item => item.classList.remove('selected'));
    div.classList.add('selected');

    sellPVOButton.disabled = true; 
  };

  menu.appendChild(div);
});



const pvoList = [];


  
map.on("click", (e) => {
  if (moveMode && movingPVO) {
    movingPVO.latlng = e.latlng;
    movingPVO.center = e.latlng;
    movingPVO.marker.setLatLng(e.latlng);
    if (movingPVO.rangeCircle) movingPVO.rangeCircle.setLatLng(e.latlng);
    moveMode = false;
    movingPVO = null;
    console.log('F-16 –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –¥–æ:', e.latlng);
    return;
  }

  if (buyingMode && selectedPVO) {
    if (!isPointOnMap(e.latlng.lat, e.latlng.lng)) {
      alert("‚ùå –ù–µ –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ü–ü–û –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ –∫–∞—Ä—Ç–∏ –£–∫—Ä–∞—ó–Ω–∏!");
      console.warn('–°–ø—Ä–æ–±–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –ü–ü–û –ø–æ–∑–∞ –∫–∞—Ä—Ç–æ—é:', e.latlng);
      return;
    }

    for (let dp of defensePoints) {
      const dx = e.latlng.lng - dp.lng;
      const dy = e.latlng.lat - dp.lat;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < 50) {
        alert("‚ùå –ù–µ –º–æ–∂–Ω–∞ —Å—Ç–∞–≤–∏—Ç–∏ –ü–ü–û –Ω–∞–¥—Ç–æ –±–ª–∏–∑—å–∫–æ –¥–æ —Ü—ñ–ª—ñ! –¢—Ä–∏–º–∞–π –≤—ñ–¥—Å—Ç–∞–Ω—å.");
        console.warn('–°–ø—Ä–æ–±–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –ü–ü–û –±–ª–∏–∑—å–∫–æ –¥–æ —Ü—ñ–ª—ñ:', e.latlng, '–¶—ñ–ª—å:', dp);
        return;
      }
    }

    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ effectiveMaxPvoCount –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª—ñ–º—ñ—Ç—É
    const effectiveMaxPvoCount = disablePvoRestrictions ? 10000000 : MAX_PVO_COUNT;
    if (pvoList.length >= effectiveMaxPvoCount) {
      alert(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ü–ü–û –Ω–∞ –∫–∞—Ä—Ç—ñ ‚Äî ${MAX_PVO_COUNT}. –ü–æ–∫—Ä–∞—â–∏ —ñ—Å–Ω—É—é—á—ñ!`);
      console.warn('–î–æ—Å—è–≥–Ω—É—Ç–æ –ª—ñ–º—ñ—Ç –ü–ü–û:', pvoList.length);
      return;
    }

    const count = pvoPurchaseCounts[selectedPVO.name] || 0;
    const dynamicPrice = Math.floor(selectedPVO.price * Math.pow(1.2, count));

    if (money < dynamicPrice) {
      alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤, –ø–æ—Ç—Ä—ñ–±–Ω–æ ${dynamicPrice} –∫–∞—Ä–±–æ–≤–∞–Ω—Ü—ñ–≤.`);
      console.warn('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ü–ü–û:', selectedPVO.name, '–¶—ñ–Ω–∞:', dynamicPrice);
      return;
    }

    const icon = L.divIcon({
      className: "rotating-icon",
      html: `<img src="${selectedPVO.img}" style="width: 40px; height: 40px;" />`,
      iconSize: [40, 40],
      iconAnchor: [20, 20]
    });

    const zoneColor = pvoColorMap[selectedPVO.name] || "#00FF00";
    const rangeCircle = L.circle(e.latlng, {
      radius: selectedPVO.radius,
      color: zoneColor,
      fillColor: zoneColor,
      fillOpacity: 0.2
    }).addTo(map);

    const marker = L.marker(e.latlng, { icon }).addTo(map);

    const pvo = {
      latlng: e.latlng,
      center: L.latLng(e.latlng.lat, e.latlng.lng),
      ...selectedPVO,
      baseDamage: selectedPVO.damage,
      baseRadius: selectedPVO.radius,
      baseCd: selectedPVO.cd,
      lastShot: 0,
      marker,
      rangeCircle,
      upgradeCount: 0,
      patrolAngle: 0,
      speed: 0.8,
      center: e.latlng
    };

    pvoList.push(pvo);
    money -= dynamicPrice;
    updateMoney();
    pvoPurchaseCounts[selectedPVO.name] = count + 1;
    updatePvoMenuPrice(selectedPVO.name);
    buyingMode = false;
    selectedPVO = null;
    updatePvoPurchaseAvailability();
    document.querySelectorAll('.pvo-item').forEach(item => item.classList.remove('selected'));
    sellPVOButton.disabled = true;
    upgradePVOButton.disabled = true;
    upgradeInfo.textContent = "";
    console.log('–†–æ–∑–º—ñ—â–µ–Ω–æ –ü–ü–û:', pvo.name, '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:', e.latlng);
    return;
  }

  let nearest = null;
  let minDist = Infinity;

  pvoList.forEach(pvo => {
    const dx = e.latlng.lng - pvo.latlng.lng;
    const dy = e.latlng.lat - pvo.latlng.lat;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist <= pvo.radius && dist < minDist) {
      nearest = pvo;
      minDist = dist;
    }
  });

  if (nearest) {
    selectedPVO = nearest;
    sellPVOButton.disabled = false;
    upgradePVOButton.disabled = nearest.noUpgrade;
    upgradeInfo.textContent = `–ü–æ–∫—Ä–∞—â–µ–Ω–æ: ${selectedPVO.upgradeCount} / 10`;
    updateUpgradeButtonText();

    if (nearest.name === "F-16") {
      movePVOButton.disabled = false;
    } else {
      movePVOButton.disabled = true;
    }
    console.log('–û–±—Ä–∞–Ω–æ –ü–ü–û:', nearest.name, '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:', nearest.latlng);
  } else {
    selectedPVO = null;
    sellPVOButton.disabled = true;
    upgradePVOButton.disabled = true;
    upgradeInfo.textContent = "";
    document.querySelectorAll('.pvo-item').forEach(item => item.classList.remove('selected'));
    console.log('–ü–ü–û –Ω–µ –æ–±—Ä–∞–Ω–æ');
  }
}); 
// üí∏ –ü—Ä–æ–¥–∞–∂ –≤–∏–±—Ä–∞–Ω–æ—ó –ü–ü–û (–ø–æ–≤–µ—Ä—Ç–∞—î 75% –≤–∞—Ä—Ç–æ—Å—Ç—ñ)
sellPVOButton.onclick = () => {
  if (!selectedPVO) return;

  money += Math.floor(selectedPVO.price * 0.75);
  updateMoney();

  map.removeLayer(selectedPVO.marker);
  
  if (selectedPVO.rangeCircle) {
    map.removeLayer(selectedPVO.rangeCircle);
  }

  const index = pvoList.indexOf(selectedPVO);
  if (index !== -1) pvoList.splice(index, 1);
updatePvoPurchaseAvailability();

  selectedPVO = null;
  sellPVOButton.disabled = true;
  
};


const droneIcon = L.icon({
  iconUrl: "assets/drone.png",
  iconSize: [25, 25],
  iconAnchor: [12, 12]
});
const heavyDroneIcon = L.icon({
  iconUrl: "assets/heavy-drone.png",
  iconSize: [20, 20],
  iconAnchor: [10, 10],
});


let drones = [];


const rocketIcon = L.icon({
  iconUrl: "assets/rocket1.png",
  iconSize: [30, 30],
  iconAnchor: [15, 15]
});

let rockets = [];


// üåä –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ö–≤–∏–ª—ñ –¥—Ä–æ–Ω—ñ–≤ —ñ —Ä–∞–∫–µ—Ç –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä—ñ–≤–Ω—è
function spawnWave(droneCount = 3, rocketCount = 0) {
  if (rightOnlyMode) {
  spawnFromRightOnly(droneCount, rocketCount);
  return;
}

  if (waveNumber >= 3) {
  let startLat = Math.random() * 2829;
  let startLng = -100 + Math.random() * 100;

  let target;
  if (Math.random() < 0.1 && pvoList.length > 0) {
    const randomPVO = pvoList[Math.floor(Math.random() * pvoList.length)];
    target = { lat: randomPVO.latlng.lat, lng: randomPVO.latlng.lng, isPVO: true };
  } else {
    const dp = defensePoints.filter(p => p.alive);
    target = dp[Math.floor(Math.random() * dp.length)];
  }

  
  const marker = L.marker([startLat, startLng], {
    icon: L.divIcon({
      className: "rotating-icon",
      html: `<img src="assets/drone.png" width="30" height="30" />`,
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    })
  }).addTo(map);

  drones.push({
    type: "light",
    position: [startLat, startLng],
    marker: marker,
    target: [target.lat, target.lng],
    speed: (0.21 + Math.random() * 0.31) + waveNumber * 0.01,
    hp: 13 + waveNumber * 10
  });
}

  const startIndex = (waveNumber >= 3) ? 1 : 0;

  for (let i = startIndex; i < droneCount; i++) {
    let startLat, startLng;
    let spawnDirections = [];

    if (waveNumber <= 4) {
      spawnDirections = ["right"];
    } else if (waveNumber <= 9) {
      spawnDirections = ["right", "bottom"];
    } else if (waveNumber <= 14) {
      spawnDirections = ["right", "bottom", "top"];
    } else {
      spawnDirections = ["right", "bottom", "top", "left"];
    }

    const chosenDirection = spawnDirections[Math.floor(Math.random() * spawnDirections.length)];

    if (chosenDirection === "right") {
      startLat = Math.random() * 2829;
      startLng = 4000 + Math.random() * 200;
    } else if (chosenDirection === "bottom") {
      startLat = 2829 + Math.random() * 200;
      startLng = Math.random() * 4000;
    } else if (chosenDirection === "top") {
      startLat = -100 + Math.random() * 100;
      startLng = Math.random() * 4000;
    } else if (chosenDirection === "left") {
      startLat = Math.random() * 2829;
      startLng = -100 + Math.random() * 100;
    }

    let target;
    if (Math.random() < 0.1 && pvoList.length > 0) {
      const randomPVO = pvoList[Math.floor(Math.random() * pvoList.length)];
      target = { lat: randomPVO.latlng.lat, lng: randomPVO.latlng.lng, isPVO: true };
    } else {
      const dp = defensePoints.filter(p => p.alive);
      target = dp[Math.floor(Math.random() * dp.length)];
    }

    drones.push({
      type: "light",
      position: [startLat, startLng],
      marker: L.marker([startLat, startLng], {
  icon: L.divIcon({
    className: "rotating-icon", 
    html: `<img src="assets/drone.png" width="40" height="40" />`,
    iconSize: [40, 40],
    iconAnchor: [20, 20]
  })
}).addTo(map),

      target: [target.lat, target.lng],
      speed: (0.21 + Math.random() * 0.31) + waveNumber * 0.01,
      hp: 13 + waveNumber * 10
    });
  }



if (waveNumber >= 5) {
  const heavyCount = waveNumber - 4;

  for (let i = 0; i < heavyCount; i++) {
    let startLat, startLng;

    if (rightOnlyMode) {
      [startLat, startLng] = spawnRight(); 
    } else {
      startLat = Math.random() * 2829;
      startLng = -150; 
    }

    const dp = defensePoints.filter(p => p.alive);
    const target = dp[Math.floor(Math.random() * dp.length)];

    drones.push({
      type: "heavy",
      position: [startLat, startLng],
      marker: L.marker([startLat, startLng], {
        icon: L.divIcon({
          className: "rotating-icon",
          html: `<img src="assets/heavy-drone.png" width="40" height="40" />`,
          iconSize: [40, 40],
          iconAnchor: [20, 20]
        })
      }).addTo(map),
      target: [target.lat, target.lng],
      speed: (0.15 + Math.random() * 0.21) + waveNumber * 0.01,
      hp: 220 + waveNumber * 27
    });
  }
}




  for (let i = 0; i < rocketCount; i++) {
    let startLat, startLng;

    const direction = ["left", "right", "top", "bottom"][Math.floor(Math.random() * 4)];

if (direction === "left") {
  startLat = Math.random() * 2829;
  startLng = -200;
} else if (direction === "right") {
  startLat = Math.random() * 2829;
  startLng = 4000 + 200;
} else if (direction === "top") {
  startLat = -200;
  startLng = Math.random() * 4000;
} else if (direction === "bottom") {
  startLat = 2829 + 200;
  startLng = Math.random() * 4000;
}


    let target;
    if (Math.random() < 0.30 && pvoList.length > 0) {
      const randomPVO = pvoList[Math.floor(Math.random() * pvoList.length)];
      target = { lat: randomPVO.latlng.lat, lng: randomPVO.latlng.lng, isPVO: true };
    } else {
      const dp = defensePoints.filter(p => p.alive);
      target = dp[Math.floor(Math.random() * dp.length)];
    }

    rockets.push({
  position: [startLat, startLng],
  marker: L.marker([startLat, startLng], {
    icon: L.divIcon({
      className: "rotating-icon",
      html: `<img src="assets/rocket1.png" width="40" height="40" />`,
      iconSize: [40, 40],
      iconAnchor: [20, 20]
    })
  }).addTo(map),
  target: [target.lat, target.lng],
  speed: (1.2 + Math.random() * 1.6) + waveNumber * 0.01,
  hp: 20 + waveNumber * 15
});

  }
}
function spawnNuke() {
  const target = defensePoints.find(p => p.alive);
  if (!target) return;

  const startPoint = rightOnlyMode ? [Math.random() * 2829, 4000 + 200] : [2500, 0]; 

  const nuke = {
    type: 'nuke',
    hp: 5000,
    speed: 1,
    position: [...startPoint],
    target: [target.lat, target.lng],
    marker: L.marker(startPoint, {
      icon: L.icon({
        iconUrl: 'assets/nuke.png', 
        iconSize: [60, 60],
        iconAnchor: [30, 30]
      })
    }).addTo(map)
  };
  rockets.push(nuke);
}

// ‚ö†Ô∏è –ê—É–¥—ñ–æ-—ñ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —Å–∏–≥–Ω–∞–ª –ø—Ä–æ –Ω–æ–≤—É —Ö–≤–∏–ª—é
function triggerWaveAlarm() {
  const sound = document.getElementById("alarmSound");
  const indicator = document.getElementById("alarmIndicator");

  if (sound) {
    sound.currentTime = 0;
    sound.play();
  }

  if (indicator) {
    indicator.style.display = "block";
    indicator.classList.add("blinking");

    
    setTimeout(() => {
      indicator.style.display = "none";
      indicator.classList.remove("blinking");
    }, 6000);
  }
}


// ‚û°Ô∏è –ì–µ–Ω–µ—Ä—É—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è –ø–æ—è–≤–∏ –¥—Ä–æ–Ω—ñ–≤ –∑ –ø—Ä–∞–≤–æ–≥–æ –±–æ–∫—É
function spawnRight() {
  const totalHeight = 2829;
  const rnd = Math.random();
  let lat;

  if (rnd < 0.3) {
    
    lat = Math.random() * (totalHeight * 0.3);
  } else {
    
    lat = totalHeight * 0.3 + Math.random() * (totalHeight * 0.7);
  }

  const lng = 4000 + Math.random() * 200;
  return [lat, lng];
}



// ‚û°Ô∏è‚û°Ô∏è –°–ø–∞–≤–Ω –¥—Ä–æ–Ω—ñ–≤ —ñ —Ä–∞–∫–µ—Ç —Ç—ñ–ª—å–∫–∏ –∑ –ø—Ä–∞–≤–æ–≥–æ –±–æ–∫—É (—Ä–µ–∂–∏–º)
function spawnFromRightOnly(droneCount, rocketCount) {
  const targetPoints = defensePoints.filter(p => p.alive);

  for (let i = 0; i < droneCount; i++) {
    const [startLat, startLng] = spawnRight();


    const target = Math.random() < 0.2 && pvoList.length > 0
      ? pvoList[Math.floor(Math.random() * pvoList.length)]
      : targetPoints[Math.floor(Math.random() * targetPoints.length)];

    drones.push({
      type: "light",
      position: [startLat, startLng],
      marker: L.marker([startLat, startLng], {
        icon: L.divIcon({
          className: "rotating-icon",
          html: `<img src="assets/drone.png" width="40" height="40" />`,
          iconSize: [40, 40],
          iconAnchor: [20, 20]
        })
      }).addTo(map),
      target: [target.lat, target.lng],
      speed: (0.21 + Math.random() * 0.31) + waveNumber * 0.01,
      hp: 13 + waveNumber * 10
    });
  }

  for (let i = 0; i < rocketCount; i++) {
    const [startLat, startLng] = spawnRight();


    const target = Math.random() < 0.3 && pvoList.length > 0
      ? pvoList[Math.floor(Math.random() * pvoList.length)]
      : targetPoints[Math.floor(Math.random() * targetPoints.length)];

    rockets.push({
      position: [startLat, startLng],
      marker: L.marker([startLat, startLng], {
        icon: L.divIcon({
          className: "rotating-icon",
          html: `<img src="assets/rocket1.png" width="40" height="40" />`,
          iconSize: [40, 40],
          iconAnchor: [20, 20]
        })
      }).addTo(map),
      target: [target.lat, target.lng],
      speed: (1.2 + Math.random() * 1.6) + waveNumber * 0.01,
      hp: 20 + waveNumber * 15
    });
  }
    

}

// üöÄ –ó–∞–ø—É—Å–∫–∞—î –Ω–æ–≤—É —Ö–≤–∏–ª—é –≤–æ—Ä–æ–≥—ñ–≤
  // –í–∏–∑–Ω–∞—á–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥—Ä–æ–Ω—ñ–≤ —ñ —Ä–∞–∫–µ—Ç, —Å—Ç–≤–æ—Ä—é—î –≤–æ—Ä–æ–≥—ñ–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ä–µ–∂–∏–º—É (—Ö–∞—Ä–¥–∫–æ—Ä, –ø—Ä–∞–≤–∏–π —Ñ–ª–∞–Ω–≥)
function startWave() {
  triggerWaveAlarm();
  console.log("üî• –°—Ç–∞—Ä—Ç –≤–æ–ª–Ω—ã", currentWave + 1);
 

 

  const droneCount = 5 + currentWave * 5;
  const rocketCount = currentWave >= 3 ? currentWave - 1 : 0;


  spawnWave(droneCount, rocketCount);
 if (rightOnlyMode && waveNumber >= 5) {
    const heavyCount = waveNumber - 4;
    for (let i = 0; i < heavyCount; i++) {
      const [startLat, startLng] = spawnRight();

      const dp = defensePoints.filter(p => p.alive);
      const target = dp[Math.floor(Math.random() * dp.length)];

      drones.push({
        type: "heavy",
        position: [startLat, startLng],
        marker: L.marker([startLat, startLng], {
          icon: L.divIcon({
            className: "rotating-icon",
            html: `<img src="assets/heavy-drone.png" width="40" height="40" />`,
            iconSize: [40, 40],
            iconAnchor: [20, 20]
          })
        }).addTo(map),
        target: [target.lat, target.lng],
        speed: (0.15 + Math.random() * 0.21) + waveNumber * 0.01,
        hp: 220 + waveNumber * 27
      });
    }
  }
  isWaveInProgress = true;
  if (hardcoreMode && currentWave >= waves.length) {
  const level = currentWave + 1;

  const newWave = {
    number: level,
    threats: [
      { type: 'drone', path: level % 2 === 0 ? 'A' : 'B', count: 50 + level * 2, delay: 500 },
      { type: 'missile', path: level % 3 === 0 ? 'C' : 'D', count: Math.floor(level * 0.7), delay: 1000 }
    ]
  };

  waves.push(newWave);
}

  const wave = waves[currentWave];
  wave.threats.forEach(threat => {
    for (let i = 0; i < threat.count; i++) {
      setTimeout(() => {
        spawnThreat(threat.type, threat.path);
      }, i * threat.delay);
    }
  });

  const longestDuration = Math.max(...wave.threats.map(t => t.count * t.delay)) + 2000;

  setTimeout(() => {
    isWaveInProgress = false;
    
  }, longestDuration);
}





function spawnThreat(type, pathKey) {
  const path = paths[pathKey];
  if (!path) return;

  if (type === 'drone') {
    createDrone(path);
  } else if (type === 'missile') {
    createMissile(path);
  }
}

function isPointOnMap(lat, lng) {
    const imageBounds = [[0, 0], [2829, 4000]];
    const [minLat, minLng] = imageBounds[0];
    const [maxLat, maxLng] = imageBounds[1];

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤ –º–µ–∂–∞—Ö –∫–∞—Ä—Ç–∏
    if (lat < minLat || lat > maxLat || lng < minLng || lng > maxLng) {
        console.log(`–¢–æ—á–∫–∞ –ø–æ–∑–∞ –º–µ–∂–∞–º–∏: lat=${lat}, lng=${lng}`);
        return false;
    }

    // –ü—Ä–æ—Å—Ç–∏–π –ø—Ä–∏–∫–ª–∞–¥: –¥–æ–∑–≤–æ–ª—è—î–º–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –ü–ü–û –≤ –º–µ–∂–∞—Ö –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞
    // –î–ª—è —Ç–æ—á–Ω—ñ—à–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ–∂–Ω–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω –£–∫—Ä–∞—ó–Ω–∏
    return true;
}

// üî´ –ü–ü–û —Å—Ç—Ä—ñ–ª—è—î –ø–æ –Ω–∞–π–±–ª–∏–∂—á–∏—Ö —Ü—ñ–ª—è—Ö —É —Ä–∞–¥—ñ—É—Å—ñ
  // –ó–º–µ–Ω—à—É—î HP –¥—Ä–æ–Ω—ñ–≤/—Ä–∞–∫–µ—Ç, —è–∫—â–æ —Ü—ñ–ª—å –∑–Ω–∏—â–µ–Ω–∞ ‚Äî –≤–∏–¥–∞–ª—è—î –∑ –∫–∞—Ä—Ç–∏
function pvoFire(ts = performance.now()) {
  pvoList.forEach(pvo => {
    if (ts - pvo.lastShot < pvo.cd) return;  

    const targets = [...drones, ...rockets].filter(t => {
      const dx = t.position[1] - pvo.latlng.lng;
      const dy = t.position[0] - pvo.latlng.lat;
      return Math.sqrt(dx * dx + dy * dy) <= pvo.radius;
    });

    if (targets.length > 0) {
      const target = targets[0];  
      target.hp -= pvo.damage;
      pvo.lastShot = ts;

      if (target.hp <= 0) {
        map.removeLayer(target.marker);
        drones = drones.filter(d => d !== target);
        rockets = rockets.filter(r => r !== target);
        score += 10;
        updateUI();
      }
    }
  });
}



// ‚úàÔ∏è –†—É—Ö –¥—Ä–æ–Ω—ñ–≤ –ø–æ –∫–∞—Ä—Ç—ñ –¥–æ —Ü—ñ–ª–µ–π
  // –†–µ–∞–≥—É—î –Ω–∞ –ü–ü–û, —É–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –≤—ñ–¥ –†–ï–ë, –≤–∏–±—É—Ö –ø—Ä–∏ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—ñ —Ü—ñ–ª—ñ
function moveDrones(ts = 0) {
  if (gameOver) return;

 
  drones.forEach(drone => {
    const currentTarget = defensePoints.find(p => p.lat === drone.target[0] && p.lng === drone.target[1]);
    if (!currentTarget || !currentTarget.alive) {
      const aliveTargets = defensePoints.filter(p => p.alive);
      if (aliveTargets.length === 0) {
        endGame();
        return;
      }
      const newTarget = aliveTargets[Math.floor(Math.random() * aliveTargets.length)];
      drone.target = [newTarget.lat, newTarget.lng];
    }
  });

  
  drones.forEach((drone, index) => {
    if (drone.hp <= 0) {
      const explosion = L.marker(drone.position, {
        icon: L.icon({ iconUrl: "assets/explosion.gif", iconSize: [40, 40], iconAnchor: [20, 20] })
      }).addTo(map);
      setTimeout(() => map.removeLayer(explosion), 600);
      map.removeLayer(drone.marker);
      drones.splice(index, 1);
      money += 90;
      score++;
      updateUI();
      return;
    }

    const dx = drone.target[0] - drone.position[0];
    const dy = drone.target[1] - drone.position[1];
    const dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < 1) {
  
  const pvoTarget = pvoList.find(pvo =>
    pvo.latlng.lat === drone.target[0] && pvo.latlng.lng === drone.target[1]
  );

  if (pvoTarget) {
    map.removeLayer(pvoTarget.marker);
    if (pvoTarget.rangeCircle) map.removeLayer(pvoTarget.rangeCircle);
    pvoList.splice(pvoList.indexOf(pvoTarget), 1);
    const explosion = L.marker(pvoTarget.latlng, {
      icon: L.icon({ iconUrl: "assets/explosion.gif", iconSize: [40, 40], iconAnchor: [20, 20] })
    }).addTo(map);
    setTimeout(() => map.removeLayer(explosion), 600);
    map.removeLayer(drone.marker);
    drones.splice(index, 1);
    return;
  }

  const target = defensePoints.find(p => p.lat === drone.target[0] && p.lng === drone.target[1]);
  if (target && target.alive) {
    target.alive = false;
    target.marker.setIcon(L.divIcon({ html: "üí•", className: "" }));
    if (target.noBuildCircle) {
  map.removeLayer(target.noBuildCircle);
  target.noBuildCircle = null;
}

  }

  map.removeLayer(drone.marker);
  drones.splice(index, 1);

  if (defensePoints.filter(p => p.alive).length === 0) {
    endGame();
  }
  return;
}


    const normDx = dx / dist;
    const normDy = dy / dist;
    
let slowed = false;
pvoList.forEach(pvo => {
  if (pvo.reb) {
    const dx = (drone.position[1] - pvo.latlng.lng);
    
    const dy = (drone.position[0] - pvo.latlng.lat);
    const dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < pvo.radius) {
      slowed = true;
    }
  }
});
if (slowed) {
  drone.speedOriginal = drone.speedOriginal || drone.speed;
  drone.speed = drone.speedOriginal * 0.4; 
} else if (drone.speedOriginal) {
  drone.speed = drone.speedOriginal;
}

    drone.position[0] += normDx * drone.speed;
    drone.position[1] += normDy * drone.speed;
    drone.marker.setLatLng(drone.position);
    
const angleRad = Math.atan2(normDy, normDx);
const angleDeg = angleRad * (180 / Math.PI);


const img = drone.marker.getElement()?.querySelector('img');
if (img) {
  img.style.transformOrigin = 'center center';
  img.style.transform = `rotate(${angleDeg}deg)`;
}


    
    pvoList.forEach(pvo => {
      const dx = (drone.position[1] - pvo.latlng.lng);
      const dy = (drone.position[0] - pvo.latlng.lat);
      const r = Math.sqrt(dx * dx + dy * dy) * PIXEL_TO_METERS;

      if (r < pvo.radius && ts - pvo.lastShot >= pvo.cd / 2) {
        drone.hp -= pvo.damage;
        pvo.lastShot = ts;
        const bulletLine = L.polyline([pvo.latlng, drone.position], {
  color: "red",
  weight: 2,
  opacity: 0.9,
  dashArray: '4, 6' 
}).addTo(map);
setTimeout(() => map.removeLayer(bulletLine), 200);

      }
    });
  });

  requestAnimationFrame(moveDrones);
}


// üí∞ –û–Ω–æ–≤–ª—é—î —Ü—ñ–Ω—É –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ü–ü–û –≤ –º–µ–Ω—é (–¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ–∫—É–ø–æ–∫)
function updatePvoMenuPrice(name) {
  const count = pvoPurchaseCounts[name] || 0;
  const dynamicPrice = Math.floor(
    pvoTypes.find(t => t.name === name).price * Math.pow(1.2, count)
  );

  const pvoDivs = document.querySelectorAll('.pvo-item');
  pvoDivs.forEach(div => {
    const title = div.querySelector('b');
    if (title && title.textContent === name) {
      
      div.innerHTML = `
        <img src="${pvoTypes.find(t => t.name === name).img}" />
        <b>${name}</b><br/>
        üí∞${dynamicPrice}<br/>
        üìè${pvoTypes.find(t => t.name === name).radius}
      `;
    }
  });
}




// üöÄ –†—É—Ö —Ä–∞–∫–µ—Ç –¥–æ —Ü—ñ–ª–µ–π, —É—Ä–∞–∂–µ–Ω–Ω—è –ø–æ –ü–ü–û –∞–±–æ –±–∞–∑–∞—Ö
  // –í—Ä–∞—Ö–æ–≤—É—î —É–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è, –≤–∏–±—É—Ö–∏, –∑–Ω–∏—â–µ–Ω–Ω—è
function moveRockets(ts = 0) {
  if (gameOver) return;

  
  rockets.forEach(rocket => {
    const currentTarget = defensePoints.find(p => p.lat === rocket.target[0] && p.lng === rocket.target[1]);
    if (!currentTarget || !currentTarget.alive) {
      const aliveTargets = defensePoints.filter(p => p.alive);
      if (aliveTargets.length === 0) {
        endGame();
        return;
      }
      const newTarget = aliveTargets[Math.floor(Math.random() * aliveTargets.length)];
      rocket.target = [newTarget.lat, newTarget.lng];
    }
  });

rockets.forEach((rocket, index) => {
  
  if (rocket.hp <= 0) {
    const isNuke = rocket.type === 'nuke';

    const explosion = L.marker(rocket.position, {
      icon: L.icon({ iconUrl: "assets/explosion.gif", iconSize: [40, 40], iconAnchor: [20, 20] })
    }).addTo(map);
    setTimeout(() => map.removeLayer(explosion), 600);
    map.removeLayer(rocket.marker);
    rockets.splice(index, 1);
    money += 350;
    score++;
    updateUI();

    if (isNuke) {
      setTimeout(checkVictory, 100);
      return;
    }

    return;
  }


    const dx = rocket.target[0] - rocket.position[0];
    const dy = rocket.target[1] - rocket.position[1];
    const dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < 1) {
      
      const pvoTarget = pvoList.find(pvo =>
        pvo.latlng.lat === rocket.target[0] && pvo.latlng.lng === rocket.target[1]
      );

      if (pvoTarget) {
        map.removeLayer(pvoTarget.marker);
        if (pvoTarget.rangeCircle) map.removeLayer(pvoTarget.rangeCircle);
        pvoList.splice(pvoList.indexOf(pvoTarget), 1);
        const explosion = L.marker(pvoTarget.latlng, {
          icon: L.icon({ iconUrl: "assets/explosion.gif", iconSize: [40, 40], iconAnchor: [20, 20] })
        }).addTo(map);
        setTimeout(() => map.removeLayer(explosion), 600);
        map.removeLayer(rocket.marker);
        rockets.splice(index, 1);
        return;
      }

      
      const target = defensePoints.find(p => p.lat === rocket.target[0] && p.lng === rocket.target[1]);
      if (target && target.alive) {
        target.alive = false;

        if (rocket.type === 'nuke') {
          setTimeout(checkVictory, 1000); 
        }

        target.marker.setIcon(L.divIcon({ html: "üí•", className: "" }));
      }

      map.removeLayer(rocket.marker);
      rockets.splice(index, 1);

      if (defensePoints.filter(p => p.alive).length === 0) {
        endGame();
      }
      return;
    }

    const normDx = dx / dist;
    const normDy = dy / dist;

    
    let slowed = false;
    pvoList.forEach(pvo => {
      if (pvo.reb) {
        const dx = (rocket.position[1] - pvo.latlng.lng);
        const dy = (rocket.position[0] - pvo.latlng.lat);
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < pvo.radius) {
          slowed = true;
        }
      }
    });

    if (slowed) {
      rocket.speedOriginal = rocket.speedOriginal || rocket.speed;
      rocket.speed = rocket.speedOriginal * 0.4; 
    } else if (rocket.speedOriginal) {
      rocket.speed = rocket.speedOriginal;
    }

    rocket.position[0] += normDx * rocket.speed;
    rocket.position[1] += normDy * rocket.speed;
    rocket.marker.setLatLng(rocket.position);

    const angleRad = Math.atan2(normDy, normDx);
    const angleDeg = angleRad * (180 / Math.PI);
    const markerEl = rocket.marker.getElement();
    if (markerEl) {
      const currentTransform = markerEl.style.transform || "";
      const newTransform = currentTransform.replace(/rotate\([^)]+\)/, "").trim();
      markerEl.style.transform = `${newTransform} rotate(${angleDeg}deg)`.trim();
      markerEl.style.transformOrigin = "center center";
    }

    
    pvoList.forEach(pvo => {
      const dx = (rocket.position[1] - pvo.latlng.lng);
      const dy = (rocket.position[0] - pvo.latlng.lat);
      const r = Math.sqrt(dx * dx + dy * dy) * PIXEL_TO_METERS;

      if (r < pvo.radius && ts - pvo.lastShot >= pvo.cd / 2) {
        rocket.hp -= pvo.damage;
        pvo.lastShot = ts;
        const bulletLine = L.polyline([pvo.latlng, rocket.position], {
          color: "yellow",
          weight: 2,
          opacity: 0.9,
          dashArray: '4, 6'
        }).addTo(map);
        setTimeout(() => map.removeLayer(bulletLine), 200);
      }
    });
  });

  requestAnimationFrame(moveRockets);
}
// ‚úàÔ∏è –†—É—Ö–ª–∏–≤—ñ –ü–ü–û (—Ç–∏–ø—É F-16) –ø–∞—Ç—Ä—É–ª—é—é—Ç—å –ø–æ –∫–æ–ª—É
  // –ü–ª–∞–≤–Ω–æ —Ä—É—Ö–∞—é—Ç—å—Å—è –Ω–∞–≤–∫–æ–ª–æ —Ü–µ–Ω—Ç—Ä—É
function moveMobilePVO(ts = 0) {
  pvoList.forEach(pvo => {
    if (!pvo.mobile || !pvo.center) return;

    pvo.patrolAngle += pvo.speed * 0.01;

    
    const patrolRadius = Math.min(pvo.radius * 0.5, 80);
    const angle = pvo.patrolAngle;

    const newLat = pvo.center.lat + (Math.sin(angle) * patrolRadius);
    const newLng = pvo.center.lng + (Math.cos(angle) * patrolRadius);
    const newPos = L.latLng(newLat, newLng);
    pvo.latlng = newPos;

    pvo.marker.setLatLng(newPos);
    if (pvo.rangeCircle) pvo.rangeCircle.setLatLng(newPos);

    
    const angleDeg = angle * (-180 / Math.PI) + 90;
    const img = pvo.marker.getElement()?.querySelector("img");
    if (img) {
      img.style.transformOrigin = "center center";
      img.style.transform = `rotate(${angleDeg}deg)`;
    }
  });

  requestAnimationFrame(moveMobilePVO);
}




let waveNumber = 1;
let nextWaveTime = 0;



// üîÑ –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥—Ä–∏
  // –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∑–∞–ø—É—Å–∫ —Ö–≤–∏–ª—å, –ø–µ—Ä–µ–º–æ–≥—É, –ø–æ—Ä–∞–∑–∫—É, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
function gameLoop(ts) {
  if (gameOver || gameWon) return;

  const elapsed = (performance.now() - gameStartTime) / 1000;

  
  if (
  (hardcoreMode || currentWave < 25) &&
  elapsed >= waveSchedule[currentWave] 
)
 {
    if (waveNumber === 3) activateDefensePoint(1);
    if (waveNumber === 6) activateDefensePoint(2);
    if (waveNumber === 8) activateDefensePoint(3);
    if (waveNumber === 12) activateDefensePoint(4);

    startWave();

    waveNumber++;
    money += waveNumber * 125;
    currentWave++;
    updateUI();
  }

  
  if (
  !gameWon &&
  !gameOver &&
  !hardcoreMode && 
  currentWave >= 25 &&
  drones.length === 0 &&
  rockets.length === 0
) {
  checkVictory();
}


  requestAnimationFrame(gameLoop);
}

// üìç –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –æ–¥–Ω—ñ—î—ó –∑ –∞–∫—Ç–∏–≤–Ω–∏—Ö –±–∞–∑/—Ü—ñ–ª–µ–π
function relocateDefensePoint() {
  
  const alivePoints = defensePoints.filter(p => p.alive);
  if (alivePoints.length === 0) return; 

  
  const pointToMove = alivePoints[Math.floor(Math.random() * alivePoints.length)];

  
  const usedCoords = defensePoints.map(p => `${p.lat},${p.lng}`);

  
  const freeSpots = allowedSpawnPoints.filter(
    ([lat, lng]) => !usedCoords.includes(`${lat},${lng}`)
  );

  if (freeSpots.length === 0) return; 

  
  const [newLat, newLng] = freeSpots[Math.floor(Math.random() * freeSpots.length)];

  
  pointToMove.lat = newLat;
  pointToMove.lng = newLng;
  pointToMove.marker.setLatLng([newLat, newLng]); 
  
if (pointToMove.noBuildCircle) {
  pointToMove.noBuildCircle.setLatLng([newLat, newLng]);
}


  
  pointToMove.marker.bindPopup("üéØ –¶—ñ–ª—å –ø–µ—Ä–µ–º—ñ—â–µ–Ω–∞!").openPopup();
  setTimeout(() => pointToMove.marker.closePopup(), 2000);

  console.log("‚ö†Ô∏è –¶—ñ–ª—å –ø–µ—Ä–µ–º—ñ—â–µ–Ω–∞ –Ω–∞:", newLat, newLng);
}



// ‚öôÔ∏è –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥—Ä–æ–Ω—ñ–≤ —ñ —Ä–∞–∫–µ—Ç –≤—Ä—É—á–Ω—É (–¥–ª—è —Ö–∞—Ä–¥–∫–æ—Ä-—Ö–≤–∏–ª—å)
function createDrone(path) {
  const spawn = paths[path][0];
  const drone = {
    type: "drone",
    position: [...spawn],
    target: getClosestAliveTarget(spawn),
    speed: 0.8,
    hp: 3,
    marker: L.marker(spawn, {
      icon: L.icon({
        iconUrl: "assets/drone.png",
        iconSize: [30, 30],
        iconAnchor: [15, 15],
        className: "rotating-icon"
      })
    }).addTo(map)
  };
  drones.push(drone);
}
function createMissile(path) {
  const spawn = paths[path][0];
  const rocket = {
    type: "missile",
    position: [...spawn],
    target: getClosestAliveTarget(spawn),
    speed: 1.2,
    hp: 5,
    marker: L.marker(spawn, {
      icon: L.icon({
        iconUrl: "assets/rocket.png",
        iconSize: [26, 26],
        iconAnchor: [13, 13]
      })
    }).addTo(map)
  };
  rockets.push(rocket);
}

// üéØ –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–∞–π–±–ª–∏–∂—á—É –∂–∏–≤—É —Ü—ñ–ª—å –¥–ª—è –¥—Ä–æ–Ω—ñ–≤/—Ä–∞–∫–µ—Ç
function getClosestAliveTarget(fromPosition) {
  const alive = defensePoints.filter(p => p.alive);
  if (alive.length === 0) return fromPosition;

  alive.sort((a, b) => {
    const da = Math.hypot(fromPosition[0] - a.lat, fromPosition[1] - a.lng);
    const db = Math.hypot(fromPosition[0] - b.lat, fromPosition[1] - b.lng);
    return da - db;
  });

  return [alive[0].lat, alive[0].lng];
}

// üèÜ –í–∏–∑–Ω–∞—á–∞—î –ø–µ—Ä–µ–º–æ–≥—É, –ø–æ–∫–∞–∑—É—î —Ñ—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –≥—É–º–æ—Ä–æ–º + –∫–Ω–æ–ø–∫–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
function checkVictory() {
  if (gameWon || gameOver) return;

  const aliveTargets = defensePoints.filter(p => p.alive);
  const aliveCount = aliveTargets.length;

  if (aliveCount > 0) {
    gameWon = true;

    let message = "üéâ –ü–µ—Ä–µ–º–æ–≥–∞! –¢–∏ –∑–∞—Ö–∏—Å—Ç–∏–≤ –£–∫—Ä–∞—ó–Ω—É!";

    if (aliveCount === 5) {
      message += "<br><b>üü¢ –û–ì–û 5/5. –ó–∞–≤—Ç—Ä–∞ 9:00 —Ä–∞–Ω–∫—É –≤ –≤–æ—î–Ω–∫–æ–º–∞—Ç—ñ —á–µ–∫–∞—î–º–æ!</b>";
    } else if (aliveCount === 4) {
      message += "<br><b>üü¢ 4 –∑ 5 –≤—Ü—ñ–ª—ñ–ª–∏. –¢–∞ –≤–∏ –ø—Ä–æ—Å—Ç–æ –º–∞–π—Å—Ç–µ—Ä –æ–±–æ—Ä–æ–Ω–∏!</b>";
    } else if (aliveCount === 3) {
      message += "<br><b>üü° –í–∏–∂–∏–ª–∏ 3 —Ü—ñ–ª—ñ. –î–æ–±—Ä–µ –ø–æ—Ç—Ä–∏–º–∞–ª–∏ —É–¥–∞—Ä!</b>";
    } else if (aliveCount === 2) {
      message += "<br><b>üü† –õ–∏—à–∏–ª–æ—Å—å –ª–∏—à–µ 2... –ê–ª–µ –∂ –ø–µ—Ä–µ–º–æ–≥–∞ ‚Äî —Ü–µ –ø–µ—Ä–µ–º–æ–≥–∞!</b>";
    } else {
      message += "<br><b>üî¥ –í–∏–∂–∏–ª–∞ –æ–¥–Ω–∞-—î–¥–∏–Ω–∞... –ê–ª–µ –º–∏ –≤–∏—Å—Ç–æ—è–ª–∏! üí™</b>";
    }

    
    message += `
      <br><br>
      <button onclick="window.open('https://send.monobank.ua/jar/z1H8hEA96', '_blank')" 
        style="padding:10px 20px; font-size:16px; background-color:#28a745; color:#fff; border:none; border-radius:8px; cursor:pointer;">
        üíö –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä—É
      </button>
    `;

    showVictoryScreen(message);
  }
}


// ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞—î –≥—Ä—É: —Å–∫–∏–¥–∞—î –∑–º—ñ–Ω–Ω—ñ, –∞–∫—Ç–∏–≤—É—î –ø–µ—Ä—à—É —Ü—ñ–ª—å, –∑–∞–ø—É—Å–∫–∞—î –≤—Å—ñ —Ü–∏–∫–ª–∏
function startGame() {
  score = 0;
  waveNumber = 1;
  currentWave = 0;
  gameStartTime = performance.now();
  activateDefensePoint(0);
  drones = [];
  rockets = [];
  startWave();

  requestAnimationFrame(gameLoop);
  requestAnimationFrame(moveDrones);
  requestAnimationFrame(moveRockets);
  requestAnimationFrame(moveMobilePVO);

}
 // üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≥—Ä–∏ (–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏)
function restartGame() { location.reload(); }

function startImmediately() {
  clearInterval(countdownInterval);
  timerBlock.style.display = "none";
  if (!gameOver && countdown <= 0) startGame();
}
// üí• –ü–æ—Ä–∞–∑–∫–∞ ‚Äî –≤—Å—ñ —Ü—ñ–ª—ñ –∑–Ω–∏—â–µ–Ω–æ. –ü–æ–∫–∞–∑—É—î –º–æ–¥–∞–ª–∫—É –∑ –∫–Ω–æ–ø–∫–∞–º–∏
function endGame() {
  gameOver = true;

  const message = `
    <div style="font-size:18px; text-align:center;">
      üü• <b>–ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞!</b><br>–í—Å—ñ —Ü—ñ–ª—ñ –∑–Ω–∏—â–µ–Ω–æ :(
      <br><br>
      <button onclick="window.open('https://send.monobank.ua/jar/z1H8hEA96', '_blank')" 
        style="padding:10px 20px; font-size:16px; background-color:#28a745; color:#fff; border:none; border-radius:8px; cursor:pointer; margin-bottom:10px;">
        ‚ô•Ô∏è –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –∞–≤—Ç–æ—Ä—ñ–≤ –≥—Ä–∏
      </button>
      <br>
      <button onclick="location.reload()" 
        style="padding:10px 20px; font-size:16px; background-color:#555; color:#fff; border:none; border-radius:8px; cursor:pointer;">
        üîÅ –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ
      </button>
    </div>
  `;

  const modal = document.createElement('div');
  modal.innerHTML = message;
  modal.style.position = 'fixed';
  modal.style.top = '50%';
  modal.style.left = '50%';
  modal.style.transform = 'translate(-50%, -50%)';
  modal.style.background = '#111';
  modal.style.color = '#fff';
  modal.style.padding = '30px';
  modal.style.borderRadius = '12px';
  modal.style.zIndex = '10000';
  modal.style.boxShadow = '0 0 20px rgba(0,0,0,0.7)';
  document.body.appendChild(modal);
}

// üñ±Ô∏è –†–æ–±–∏—Ç—å controlPanel –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–∏–º (drag & drop)
function makeDraggable(panel, handle) {
  let isDragging = false;
  let offsetX = 0;
  let offsetY = 0;

  handle.onmousedown = function(e) {
    isDragging = true;
    offsetX = e.clientX - panel.offsetLeft;
    offsetY = e.clientY - panel.offsetTop;

    document.onmousemove = function(e) {
      if (!isDragging) return;
      panel.style.left = (e.clientX - offsetX) + 'px';
      panel.style.top = (e.clientY - offsetY) + 'px';
    };

    document.onmouseup = function() {
      isDragging = false;
      document.onmousemove = null;
      document.onmouseup = null;
    };
  };
  
} startGame(); 
}



//const waveSchedule = [10, 30, 50, 70, 120, 170, 220, 270, 320, 370, 420, 470, 520, 570, 620, 670, 720, 750, 810]; 
//const waveSchedule = Array.from({ length: 50 }, (_, i) => i * 45);


// üïí –ú–∞—Å–∏–≤ —ñ–∑ —Ä–æ–∑–∫–ª–∞–¥–æ–º —Ö–≤–∏–ª—å (—Å–µ–∫—É–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É –∫–æ–∂–Ω–æ—ó)
const waveSchedule = [5, 10, 30, 50, 70, ...Array.from({ length: 999 }, (_, i) => 70 + (i + 1) * 45)];

 

const waves = [
  { number: 1, threats: [ { type: 'drone', path: 'A', count: 50, delay: 1000 } ] },
  { number: 2, threats: [ { type: 'drone', path: 'A', count: 50, delay: 800 } ] },
  { number: 3, threats: [ { type: 'drone', path: 'A', count: 7, delay: 700 } ] },
  { number: 4, threats: [ { type: 'drone', path: 'B', count: 5, delay: 900 } ] },
  { number: 5, threats: [
    { type: 'drone', path: 'A', count: 6, delay: 700 },
    { type: 'drone', path: 'B', count: 4, delay: 1000 }
  ] },
  { number: 6, threats: [ { type: 'missile', path: 'C', count: 2, delay: 1500 } ] },
  { number: 7, threats: [
    { type: 'drone', path: 'A', count: 5, delay: 600 },
    { type: 'missile', path: 'C', count: 3, delay: 1300 }
  ] },
  { number: 8, threats: [
    { type: 'drone', path: 'B', count: 6, delay: 600 },
    { type: 'missile', path: 'D', count: 3, delay: 1400 }
  ] },
  { number: 9, threats: [
    { type: 'drone', path: 'A', count: 8, delay: 500 },
    { type: 'drone', path: 'B', count: 5, delay: 800 },
    { type: 'missile', path: 'C', count: 4, delay: 1200 }
  ] },
  { number: 10, threats: [
    { type: 'drone', path: 'A', count: 10, delay: 500 },
    { type: 'drone', path: 'B', count: 6, delay: 700 },
    { type: 'missile', path: 'D', count: 5, delay: 1000 }
  ] },
  { number: 11, threats: [
    { type: 'drone', path: 'A', count: 42, delay: 500 },
    { type: 'drone', path: 'B', count: 28, delay: 600 },
    { type: 'missile', path: 'A', count: 7, delay: 1200 }
  ] },
  { number: 12, threats: [
    { type: 'drone', path: 'A', count: 46, delay: 500 },
    { type: 'drone', path: 'B', count: 32, delay: 600 },
    { type: 'missile', path: 'D', count: 8, delay: 1200 }
  ] },
  { number: 13, threats: [
    { type: 'drone', path: 'A', count: 51, delay: 500 },
    { type: 'drone', path: 'B', count: 35, delay: 600 },
    { type: 'missile', path: 'A', count: 10, delay: 1200 }
  ] },
  { number: 14, threats: [
    { type: 'drone', path: 'A', count: 56, delay: 500 },
    { type: 'drone', path: 'B', count: 38, delay: 600 },
    { type: 'missile', path: 'D', count: 11, delay: 1200 }
  ] },
  { number: 15, threats: [
    { type: 'drone', path: 'A', count: 60, delay: 500 },
    { type: 'drone', path: 'B', count: 40, delay: 600 },
    { type: 'missile', path: 'C', count: 14, delay: 1200 }
  ] },
  { number: 16, threats: [
    { type: 'drone', path: 'A', count: 58, delay: 500 },
    { type: 'drone', path: 'B', count: 40, delay: 600 },
    { type: 'missile', path: 'D', count: 15, delay: 1200 }
  ] },
  { number: 17, threats: [
    { type: 'drone', path: 'A', count: 57, delay: 500 },
    { type: 'drone', path: 'B', count: 39, delay: 600 },
    { type: 'missile', path: 'A', count: 16, delay: 1200 }
  ] },
  { number: 18, threats: [
    { type: 'drone', path: 'A', count: 56, delay: 500 },
    { type: 'drone', path: 'B', count: 38, delay: 600 },
    { type: 'missile', path: 'D', count: 17, delay: 1200 }
  ] },
  { number: 19, threats: [
    { type: 'drone', path: 'A', count: 55, delay: 500 },
    { type: 'drone', path: 'B', count: 37, delay: 600 },
    { type: 'missile', path: 'C', count: 18, delay: 1200 }
  ] },
  { number: 20, threats: [
    { type: 'drone', path: 'A', count: 54, delay: 500 },
    { type: 'drone', path: 'B', count: 36, delay: 600 },
    { type: 'missile', path: 'D', count: 20, delay: 1200 }
  ] },
  { number: 21, threats: [ { type: 'drone', path: 'A', count: 60, delay: 500 }, { type: 'missile', path: 'D', count: 20, delay: 1200 } ] },
{ number: 22, threats: [ { type: 'drone', path: 'B', count: 65, delay: 500 }, { type: 'missile', path: 'C', count: 22, delay: 1100 } ] },
{ number: 23, threats: [ { type: 'drone', path: 'A', count: 70, delay: 500 }, { type: 'missile', path: 'A', count: 25, delay: 1000 } ] },
{ number: 24, threats: [ { type: 'drone', path: 'B', count: 75, delay: 500 }, { type: 'missile', path: 'B', count: 28, delay: 1000 } ] },
{ number: 25, threats: [ { type: 'drone', path: 'A', count: 80, delay: 500 }, { type: 'missile', path: 'D', count: 30, delay: 900 } ] }

];


const paths = {
  A: [ [10, 10], [20, 20], [30, 30], [40, 40] ],       
  B: [ [90, 10], [80, 20], [70, 30], [60, 40] ],       
  C: [ [10, 90], [20, 80], [30, 70], [40, 60] ],       
  D: [ [90, 90], [80, 80], [70, 70], [60, 60] ],       
};

// üîí –õ—ñ–º—ñ—Ç –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ü–ü–û –Ω–∞ –∫–∞—Ä—Ç—ñ

// üìä DOM-–µ–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

const waveDisplay = document.getElementById("waveDisplay");
const scoreDisplay = document.getElementById("scoreDisplay");
const moneyDisplay = document.getElementById("money");

function updateMoney() {
  moneyDisplay.textContent = money;
}
// üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É: –≥—Ä–æ—à—ñ, —Ö–≤–∏–ª—è, —Ä–∞—Ö—É–Ω–æ–∫, –∫–Ω–æ–ø–∫–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
function updateUI() {
  updateMoney();
  waveDisplay.textContent = currentWave + 1;
  scoreDisplay.textContent = score;
}
function updateUpgradeButtonText() {
  if (!selectedPVO) return;
  const baseUpgradeCost = 100;
  const upgradeCost = baseUpgradeCost * Math.pow(2, selectedPVO.upgradeCount);
  upgradePVOButton.textContent = `–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –ü–ü–û (üí∞${upgradeCost})`;
}


// üéâ –í–∏–≤—ñ–¥ –ø–µ—Ä–µ–º–æ–∂–Ω–æ–≥–æ –µ–∫—Ä–∞–Ω—É –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º
function showVictoryScreen(text = "üéâ –ü–µ—Ä–µ–º–æ–≥–∞!") {
  const div = document.createElement("div");
  div.style.position = "absolute";
  div.style.top = "50%";
  div.style.left = "50%";
  div.style.transform = "translate(-50%, -50%)";
  div.style.padding = "30px";
  div.style.background = "white";
  div.style.border = "3px solid green";
  div.style.zIndex = "9999";
  div.style.fontSize = "24px";
  div.style.textAlign = "center";
  div.innerHTML = text + "<br><br><button onclick='location.reload()'>üîÅ –ì—Ä–∞—Ç–∏ —â–µ —Ä–∞–∑</button>";
  document.body.appendChild(div);
}

// üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏, –¥–µ –º–æ–∂—É—Ç—å –∑‚Äô—è–≤–ª—è—Ç–∏—Å—è –Ω–æ–≤—ñ —Ü—ñ–ª—ñ
const allowedSpawnPoints = [
  [1870, 780],
  [1400, 1100],
  [2200, 1760],
  [1670, 1340],
  [1515, 900],
  [2040, 1870],
  [1400, 1555],
  [1913, 888],
  [1300, 1500],
  [1788, 680],
  [1946, 1200],
  [1920, 1200],
  [1827, 2401],
  [1984, 2225] ,
  [1568, 2225] ,
  [1591, 1999] ,
  [1366, 1687] ,
  [1216, 2512] ,
  [2222, 2225] ,
  [2100, 1679] ,
  [1687, 600] ,
  [2200, 878] ,
  [1700, 3000] , 
  [1600, 3000],  
  [1500, 3000], 
  [1400, 3000] ,
  [1300, 3000] 
];



const controlPanel = document.getElementById("controlPanel");
const dragHandle = document.getElementById("dragHandle");

makeDraggable(controlPanel, dragHandle);

updateUI();

</script>

</body>
</html>


